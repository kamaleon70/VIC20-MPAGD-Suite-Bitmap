ca65 V2.13.3 - (C) Copyright 1998-2012 Ullrich von Bassewitz
Main file   : loader.inc
Current file: loader.inc

000000r 1               ;---------------------------------------------------------------------
000000r 1               ; AGD LOADER,
000000r 1               ;
000000r 1               ; - load AGDSWR at $3c00-$7bff
000000r 1               ; - switch SWRAM bank 4
000000r 1               ; - upload $2200-$7bff -> $8000-$bfff
000000r 1               ; - load AGDRAM at $2600
000000r 1               ; - switch SWRAM bank 4
000000r 1               ; - start game
000000r 1               ;---------------------------------------------------------------------
000000r 1               
000000r 1               AGDRAMload	= $2200
000000r 1               AGDSWRload	= $3c00
000000r 1               SWRaddress	= $8000
000000r 1               boot_game	= $2200
000000r 1               OSFILE		= $ffdd
000000r 1               
000000r 1               .org $2100
002100  1               
002100  1               ; - load AGDSWR at $3c00-$7bff
002100  1               
002100  1  A2 51        	ldx #<loadAGDSWR		; Set pointer to loaderblock1
002102  1  A0 21        	ldy #>loadAGDSWR
002104  1  A9 FF        	lda #$ff
002106  1  20 DD FF     	jsr OSFILE
002109  1               
002109  1               ; - switch SWRAM bank 4
002109  1               
002109  1  A9 04        	lda #4				; select SWRAM
00210B  1  85 F4        	sta $f4
00210D  1  8D 30 FE     	sta $fe30
002110  1               
002110  1               ; - upload $3b00-$7bff -> $8000-$bfff
002110  1               
002110  1  A2 40        	ldx #$40			; Nr of blocks
002112  1  A0 00        	ldy #0
002114  1               uploop:
002114  1  B9 00 3C     	lda AGDSWRload, y
002117  1  99 00 80     	sta SWRaddress, y
00211A  1  C8           	iny
00211B  1  D0 F7        	bne uploop
00211D  1  EE 16 21     	inc uploop + 2
002120  1  EE 19 21     	inc uploop + 5
002123  1  CA           	dex
002124  1  D0 EE        	bne uploop
002126  1               
002126  1               ; - load AGDRAM at $2200
002126  1               
002126  1  A2 6A        	ldx #<loadAGDRAM		; Set pointer to loaderblock2
002128  1  A0 21        	ldy #>loadAGDRAM
00212A  1  A9 FF        	lda #$ff
00212C  1  20 DD FF     	jsr OSFILE
00212F  1               
00212F  1               ; - upload $2200-$7bff -> $8000-$bfff
00212F  1               
00212F  1  A2 5A        	ldx #$5a			; Nr of blocks
002131  1  A0 FF        	ldy #$ff
002133  1               uploop1:
002133  1  B9 00 7B     	lda $7b00, y
002136  1  99 00 7F     	sta $7f00, y
002139  1  88           	dey
00213A  1  C0 FF        	cpy #$ff
00213C  1  D0 F5        	bne uploop1
00213E  1  CE 35 21     	dec uploop1 + 2
002141  1  CE 38 21     	dec uploop1 + 5
002144  1  CA           	dex
002145  1  D0 EC        	bne uploop1
002147  1               
002147  1               ; - switch SWRAM bank 4
002147  1               
002147  1  A9 04        	lda #4				; select SWRAM
002149  1  85 F4        	sta $f4
00214B  1  8D 30 FE     	sta $fe30
00214E  1               
00214E  1               ; - start game
00214E  1               
00214E  1  4C 00 22     	jmp boot_game
002151  1               
002151  1               ;---------------------------------------------------------------------
002151  1               
002151  1  63 21        loadAGDSWR:	.byte <file1,>file1
002153  1  00 3C 00 00  		.byte <AGDSWRload,>AGDSWRload,0,0
002157  1  00 3C 00 00  		.byte <AGDSWRload,>AGDSWRload,0,0
00215B  1  00 00 00 00  		.byte 0,0,0,0,0,0,0,0
00215F  1  00 00 00 00  
002163  1  41 47 44 53  file1:		.byte "AGDSWR",$0d
002167  1  57 52 0D     
00216A  1               
00216A  1  7C 21        loadAGDRAM:	.byte <file2,>file2
00216C  1  00 22 00 00  		.byte <AGDRAMload,>AGDRAMload,0,0
002170  1  00 22 00 00  		.byte <AGDRAMload,>AGDRAMload,0,0
002174  1  00 00 00 00  		.byte 0,0,0,0,0,0,0,0
002178  1  00 00 00 00  
00217C  1  41 47 44 52  file2:		.byte "AGDRAM",$0d
002180  1  41 4D 0D     
002182  1               
